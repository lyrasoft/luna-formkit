{"version":3,"sources":["formkit.ts"],"names":[],"mappings":"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","file":"formkit.js","sourcesContent":["\r\nimport '@main';\r\n\r\nu.formValidation();\r\n\r\nclass FormkitHandler {\r\n  constructor(protected el: HTMLElement, protected uid: string) {\r\n    this.registerValidation();\r\n    this.autoCheckOther();\r\n  }\r\n\r\n  async registerValidation() {\r\n    const form = this.el.querySelector('form')!;\r\n\r\n    const action = u.route('formkit.action.' + this.uid);\r\n    const button = this.el.querySelector<HTMLButtonElement>('[data-task=submit]')!;\r\n\r\n    button.addEventListener('click', () => {\r\n      form.action = action;\r\n      form.requestSubmit();\r\n\r\n      setTimeout(() => {\r\n        form.removeAttribute('action');\r\n      }, 500);\r\n    });\r\n\r\n    form.addEventListener('submit', (e) => {\r\n      let invalid = 0;\r\n      let scrollTarget: HTMLElement | undefined = undefined;\r\n      const $form = e.currentTarget as HTMLFormElement;\r\n\r\n      // 驗證選擇列表\r\n      // -----------------------------\r\n      // const fields = $form.querySelectorAll<HTMLDivElement>('.input-list-container[required]');\r\n\r\n      // 驗證矩陣\r\n      // -----------------------------\r\n      const grids = form.querySelectorAll<HTMLElement>('.c-grid-scale[required]');\r\n\r\n      for (const grid of grids) {\r\n        const $rows = grid.querySelectorAll('tbody > tr');\r\n\r\n        // 移除前次驗證的資訊\r\n        grid.closest<HTMLElement>('.form-group')!.classList.remove('has-invalid');\r\n\r\n        for (const $row of $rows) {\r\n          const $inputs = Array.from(\r\n            $row.querySelectorAll<HTMLInputElement>('[type=checkbox], [type=radio]')\r\n          );\r\n          const checked = $inputs.filter((input) => input.checked);\r\n\r\n          // 移除前次驗證的資訊\r\n          // $row.closest('.form-group').removeClass('has-invalid');\r\n          $row.querySelector('.invalid-feedback')?.remove();\r\n\r\n          for (const $input of $inputs) {\r\n            $input.setCustomValidity('');\r\n          }\r\n\r\n          // 確認沒有勾選就產生錯誤提示\r\n          if (checked.length === 0) {\r\n            const text = u.__('unicorn.message.validation.value.missing');\r\n            const help = u.html(`<small class=\"invalid-feedback form-control-tooltip d-block\">${text}</small>`);\r\n\r\n            // 設定 HTML5 驗證結果\r\n            for (const $input of $inputs) {\r\n              $input.setCustomValidity(text);\r\n            }\r\n\r\n            // 插入提示\r\n            $row.querySelector('.c-row-text')!.appendChild(help);\r\n            grid.closest<HTMLElement>('.form-group')!.classList.add('has-invalid');\r\n\r\n            // 準備滑動到第一個物件\r\n            if (!scrollTarget) {\r\n              scrollTarget = grid;\r\n            }\r\n\r\n            invalid++;\r\n          }\r\n        }\r\n      }\r\n\r\n      if (invalid > 0) {\r\n        if (scrollTarget) {\r\n          scrollTarget.scrollIntoView();\r\n        }\r\n\r\n        e.stopImmediatePropagation();\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      }\r\n    });\r\n  }\r\n\r\n  autoCheckOther() {\r\n    u.selectAll<HTMLInputElement>('.js-other-text', (el) => {\r\n      el.addEventListener('input', () => {\r\n        const option = el.closest('[data-input-option]')\r\n          ?.querySelector<HTMLInputElement>('[data-radio-item-input], [data-checkbox-item-input]');\r\n\r\n        if (option) {\r\n          option.checked = true;\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nu.directive(\r\n  'formkit',\r\n  {\r\n    mounted(el, { value }) {\r\n      u.module<any, HTMLElement>(el, 'formkit', (el) => new FormkitHandler(el, value))\r\n    }\r\n  }\r\n)\r\n"]}